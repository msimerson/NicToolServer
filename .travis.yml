language: perl
perl:
# - "5.22"
  - "5.18"
# - "5.10"

services:
    - mysql

addons:
  apt:
    packages:
    - expat
    - gettext
    - apache2
    - libapache2-mod-perl2
    - libapache2-mod-perl2-dev
    - bind9utils

before_install:
    # global/system installed perl modules
    - curl -L https://cpanmin.us | sudo perl - --sudo App::cpanminus
    - sudo cpanm --notest JSON MIME::Base32 DBI DBIx::Simple DBD::mysql XML::Parser RPC::XML Digest::SHA1 Apache::DBI CryptX Net::IP SOAP::Lite Digest::HMAC Net::DNS Time::TAI64 BIND::Conf_Parser Test::HTML::Lint Params::Validate
    # - sudo cpanm --notest Crypt::Mac::HMAC Crypt::KeyDerivation Shell Net::DNS::ZoneFile LWP::UserAgent

install:
    # - cpanm --quiet --installdeps --notest .
    - cp .test/nictoolserver.conf lib/nictoolserver.conf
    - sudo cp .test/apache-nictool.conf /etc/apache2/sites-enabled/
    - sudo service apache2 restart || sudo cat /var/log/apache2/error.log
    - sudo perl .test/create_tables.pl

before_script:

script:
    - sudo perl Makefile.PL
    - sudo make test

after_success:
after_failure:
#   - pwd
#   - cat /var/log/apache2/error.log
#   - cat /etc/apache2/apache2.conf
#   - ls /usr/lib/apache2/modules/
after_script:

sudo: required
